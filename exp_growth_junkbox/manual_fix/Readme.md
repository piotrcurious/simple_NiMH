AI generated
manually fixed to work

many weird bugs were introduced by AI and it's interesting excercise to make it work.

